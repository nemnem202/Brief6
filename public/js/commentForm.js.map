{"version":3,"file":"commentForm.js","sources":["../../../src/scripts/commentForm.ts"],"sourcesContent":["const addCommentButton: HTMLElement | null = document.getElementById(\"commentButton\");\r\naddCommentButton?.addEventListener(\"click\", () => addCommentForm);\r\n\r\nfunction addCommentForm(): void {\r\n  const main: HTMLElement | null = document.querySelector(\"main\");\r\n\r\n  const formContainer: HTMLDivElement = document.createElement(\"div\");\r\n  formContainer.id = \"formContainer\";\r\n  formContainer.classList.add(\"form-container\");\r\n  formContainer.addEventListener(\"click\", closeCommentForm);\r\n\r\n  const commentForm: HTMLFormElement = document.createElement(\"form\");\r\n  commentForm.classList.add(\"comment-form\");\r\n  commentForm.addEventListener(\"click\", (e) => {\r\n    e.stopPropagation();\r\n  })\r\n  commentForm.addEventListener(\"submit\", (e) => {\r\n    e.preventDefault();\r\n\r\n    const userName: string = userInput.value.trim();\r\n    const userComment: string = userCommentInput.value.trim();\r\n    const userNote: string = userNoteSelect.value;\r\n    const recipeIdRegex: RegExp = /\\d{1,}$/;\r\n    const recipeNumber: RegExpExecArray | null = recipeIdRegex.exec(window.location.href);\r\n    if (!recipeNumber || !userName || !userComment) return;\r\n    sendCommentToServer(userName, userComment, userNote, recipeNumber[0]);\r\n    console.log(userName, userComment, userNote, recipeNumber[0]);\r\n  });\r\n\r\n  const userLabel: HTMLLabelElement = document.createElement(\"label\");\r\n  userLabel.htmlFor = \"user-name\";\r\n  userLabel.textContent = \"Nom d’utilisateur :\";\r\n  userLabel.classList.add(\"form-label\");\r\n\r\n  const userInput: HTMLInputElement = document.createElement(\"input\");\r\n  userInput.type = \"text\";\r\n  userInput.id = \"user-name\";\r\n  userInput.name = \"user-name\";\r\n  userInput.placeholder = \"FoodLover\";\r\n  userInput.classList.add(\"form-input\");\r\n  userInput.required = true;\r\n\r\n  const userCommentLabel: HTMLLabelElement = document.createElement(\"label\");\r\n  userCommentLabel.htmlFor = \"user-comment\";\r\n  userCommentLabel.textContent = \"Votre commentaire :\";\r\n  userCommentLabel.classList.add(\"form-label\");\r\n\r\n  const userCommentInput: HTMLTextAreaElement = document.createElement(\"textarea\");\r\n  userCommentInput.cols = 1;\r\n  userCommentInput.rows = 5;\r\n  userCommentInput.id = \"user-comment\";\r\n  userCommentInput.name = \"user-comment\";\r\n  userCommentInput.placeholder = \"Saisissez votre commentaire ici…\";\r\n  userCommentInput.classList.add(\"form-input\");\r\n  userCommentInput.required = true;\r\n\r\n  const userNoteLabel: HTMLLabelElement = document.createElement(\"label\");\r\n  userNoteLabel.htmlFor = \"user-note\";\r\n  userNoteLabel.textContent = \"Votre note :\";\r\n  userNoteLabel.classList.add(\"form-label\");\r\n\r\n  const userNoteSelect: HTMLSelectElement = document.createElement(\"select\");\r\n  userNoteSelect.id = \"user-note\";\r\n  userNoteSelect.name = \"user-note\";\r\n  userNoteSelect.classList.add(\"form-input\");\r\n  for (let i = 1; i <= 5; i++) {\r\n    const option = document.createElement(\"option\");\r\n    option.value = i.toString();\r\n    option.text = i.toString();\r\n    userNoteSelect.appendChild(option);\r\n  }\r\n\r\n  const formButtonContainer: HTMLDivElement = document.createElement(\"div\");\r\n  formButtonContainer.classList.add(\"form-button-container\");\r\n\r\n  const postCommentButton: HTMLInputElement = document.createElement(\"input\");\r\n  postCommentButton.type = \"submit\";\r\n  postCommentButton.value = \"Envoyer\";\r\n  postCommentButton.classList.add(\"form-button\");\r\n\r\n  const cancelButton: HTMLButtonElement = document.createElement(\"button\");\r\n  cancelButton.type = \"button\";\r\n  cancelButton.innerText = \"Annuler\";\r\n  cancelButton.classList.add(\"form-button\");\r\n  cancelButton.onclick = closeCommentForm;\r\n\r\n  formButtonContainer.append(cancelButton, postCommentButton)\r\n  commentForm.append(userLabel, userInput,\r\n    userCommentLabel, userCommentInput,\r\n    userNoteLabel, userNoteSelect,\r\n    formButtonContainer);\r\n  formContainer.append(commentForm);\r\n  main?.append(formContainer);\r\n}\r\n\r\nfunction closeCommentForm(): void {\r\n  const formContainer: HTMLElement | null = document.getElementById(\"formContainer\");\r\n  formContainer?.remove();\r\n}\r\n\r\nfunction validateFormData(name: string, comment: string, note: number, recipeNumber: string) {\r\n  let errors: string[] = [];\r\n  let isValidName = true;\r\n  let isValidComment = true;\r\n  let isValidNote = true;\r\n  let isValidRecipeNumber = true;\r\n\r\n  if (!/^[a-zA-Z0-9]+$/.test(name) || name.length < 3 || name.length > 20) { isValidName = false; }\r\n\r\n  if (!/^[a-zA-ZÀ-ÖØ-öø-ÿ0-9\\s'’,.!]+$/.test(comment) || comment.length < 10 || comment.length > 250 ) { isValidComment = false; }\r\n\r\n  for (const character of recipeNumber) { if (Number.isNaN(character)) { isValidRecipeNumber = false; } }\r\n\r\n  if (Number.isNaN(note) || note > 5 || note < 0) { isValidNote = false; }\r\n\r\n  if (!isValidName) { errors.push(\"Le nom d'utlisateur doit comprendre entre 3 et 20 caractères (majuscules, minuscules ou chiffres).\"); }\r\n\r\n  if (!isValidComment) { errors.push(\"Le commentaire doit comprendre entre 10 et 250 caractères.\"); }\r\n\r\n  if (!isValidNote) { errors.push(\"Note incorrecte.\"); }\r\n\r\n  if (!isValidRecipeNumber) { errors.push(\"Numéro de recette incorrect.\"); }\r\n\r\n  if (errors.length > 0) { throw new Error(errors.join(\"\\n\")); }\r\n}\r\n\r\nfunction sendCommentToServer(name: string, comment: string, note: string, recipeNumber: string): void {\r\n  try {\r\n    validateFormData(name, comment, parseInt(note), recipeNumber);\r\n  } catch (error) {\r\n    alert(error);\r\n    return;\r\n  }\r\n\r\n  const commentProcess = fetch(\"/recipes/byId/:id\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\"\r\n    },\r\n    body: JSON.stringify({\r\n      user: name,\r\n      message: comment,\r\n      note: note,\r\n      id: recipeNumber\r\n    })\r\n  })\r\n    .then(response => {\r\n      if (!response.ok) throw new Error(\"Erreur lors de l’envoi\");\r\n      return response.json();\r\n    })\r\n    .then(data => {\r\n      console.log(\"Commentaire envoyé :\", data);\r\n      location.reload();\r\n    })\r\n    .catch(error => {\r\n      console.error(\"Erreur :\", error);\r\n      alert(\"Une erreur est survenue lors de l’envoi du commentaire.\");\r\n    });\r\n}\r\n"],"names":[],"mappings":"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"}